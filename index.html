<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Kemopetrol Gig Archive</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
  body {
    font-family: Arial, sans-serif;
    background-color: #0b0b0c;
    color: #e0e0e0;
    margin: 0;
    padding: 20px;
  }
  h1 {
    text-align: center;
  }
  .filters {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-bottom: 20px;
    justify-content: center;
  }
  input, select {
    padding: 6px;
    font-size: 14px;
  }
  table {
    width: 100%;
    border-collapse: collapse;
  }
  th, td {
    padding: 8px;
    border-bottom: 1px solid #444;
    text-align: left;
  }
  th {
    background-color: #1a1a1a;
  }
</style>
</head>
<body>

<h1>Kemopetrol Gig Archive</h1>

<div class="filters">
  <input type="text" id="search" placeholder="Search...">
  <select id="yearFilter">
    <option value="">All years</option>
  </select>
  <select id="venueFilter">
    <option value="">All venues</option>
  </select>
  <select id="cityFilter">
    <option value="">All cities</option>
  </select>
  <select id="countryFilter">
    <option value="">All countries</option>
  </select>
</div>

<table id="gigTable">
  <thead>
    <tr>
      <th>Date</th>
      <th>Venue / Event</th>
      <th>City</th>
      <th>Country</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script src="gigs.js"></script>
<script>
(function(){
  const gigs = window.gigs;

  gigs.sort((a, b) => {
    const [da, ma, ya] = a.date.split(".");
    const [db, mb, yb] = b.date.split(".");
    return new Date(`${yb}-${mb}-${db}`) - new Date(`${ya}-${ma}-${da}`);
  }).reverse(); // newest first

  const tbody = document.querySelector('#gigTable tbody');
  const yearFilter = document.getElementById('yearFilter');
  const venueFilter = document.getElementById('venueFilter');
  const cityFilter = document.getElementById('cityFilter');
  const countryFilter = document.getElementById('countryFilter');
  const searchInput = document.getElementById('search');

  // Populate filters
  const years = [...new Set(gigs.map(g => g.date.split(".")[2]))].sort((a,b) => b-a);
  years.forEach(y => {
    const opt = document.createElement('option');
    opt.value = y;
    opt.textContent = y;
    yearFilter.appendChild(opt);
  });

  const venues = [...new Set(gigs.map(g => g.venue))].sort();
  venues.forEach(v => {
    const opt = document.createElement('option');
    opt.value = v;
    opt.textContent = v;
    venueFilter.appendChild(opt);
  });

  const cities = [...new Set(gigs.map(g => g.city))].sort();
  cities.forEach(c => {
    const opt = document.createElement('option');
    opt.value = c;
    opt.textContent = c;
    cityFilter.appendChild(opt);
  });

  const countries = [...new Set(gigs.map(g => g.country))].sort();
  countries.forEach(c => {
    const opt = document.createElement('option');
    opt.value = c;
    opt.textContent = c;
    countryFilter.appendChild(opt);
  });

  function render() {
    const searchTerm = searchInput.value.toLowerCase();
    const yearVal = yearFilter.value;
    const venueVal = venueFilter.value;
    const cityVal = cityFilter.value;
    const countryVal = countryFilter.value;

    tbody.innerHTML = '';
    gigs
      .filter(g => 
        (!yearVal || g.date.endsWith(yearVal)) &&
        (!venueVal || g.venue === venueVal) &&
        (!cityVal || g.city === cityVal) &&
        (!countryVal || g.country === countryVal) &&
        (
          g.date.toLowerCase().includes(searchTerm) ||
          g.venue.toLowerCase().includes(searchTerm) ||
          g.city.toLowerCase().includes(searchTerm) ||
          g.country.toLowerCase().includes(searchTerm)
        )
      )
      .forEach(g => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${g.date}</td>
          <td>${g.venue}</td>
          <td>${g.city}</td>
          <td>${g.country}</td>
        `;
        tbody.appendChild(tr);
      });
  }

  searchInput.addEventListener('input', render);
  yearFilter.addEventListener('change', render);
  venueFilter.addEventListener('change', render);
  cityFilter.addEventListener('change', render);
  countryFilter.addEventListener('change', render);

  render();
})();
</script>

</body>
</html>
